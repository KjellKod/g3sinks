image:
  - Visual Studio 2017

clone_folder: c:\projects\source

build_script:
- cmd: >-
    cd c:\projects

    git clone https://github.com/KjellKod/g3log.git 

    cd g3log

    mkdir build

    cd build

    cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=c:\Libraries -DCMAKE_INSTALL_PREFIX=c:\Libraries -DG3_SHARED_LIB=OFF -DG3_SHARED_RUNTIME=ON ..

    cmake --build . --target INSTALL --config Release
    

    mkdir ZLib

    cd Zlib 
    
    curl http://zlib.net/zlib-1.2.11.tar.gz -o zlib.tar.gz

    tar xvzf zlib.tar.gz

    cd zlib-1.2.11/

    mkdir build

    cd build 

    cmake -DCMAKE_PREFIX_PATH=c:\\Libraries -DCMAKE_INSTALL_PREFIX=c:\\Libraries ..

    cmake --build . --target INSTALL --config Release


    set PATH=c:\\Libraries\\bin;%PATH%

    cd c:\projects\source\

    mkdir build

    cd build 

    cmake -DCMAKE_BUILD_TYPE=Release -DCHOICE_BUILD_STATIC=ON -DCMAKE_PREFIX_PATH=c:\Libraries -DCMAKE_INSTALL_PREFIX=c:\Libraries  ..    

    cmake --build . --target INSTALL --config Release

    tree /A /F c:\g3log

    cpack -G "NSIS;ZIP"

    cpack -C Release

    ctest -V
